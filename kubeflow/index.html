
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../first_deployments/">
      
      
        <link rel="next" href="../vanilla/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.16">
    
    
      
        <title>Kubeflow - McCl8s</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="pink" data-md-color-accent="purple">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#kubeflow" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="McCl8s" class="md-header__button md-logo" aria-label="McCl8s" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            McCl8s
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Kubeflow
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="pink" data-md-color-accent="purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="pink" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="McCl8s" class="md-nav__button md-logo" aria-label="McCl8s" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    McCl8s
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../topics/" class="md-nav__link">
        Learning topics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../setup/" class="md-nav__link">
        Setup
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../ansible_cluster/" class="md-nav__link">
        Cluster setup with Ansible
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../k8s_management/" class="md-nav__link">
        Managing a MicroK8s cluster
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../first_deployments/" class="md-nav__link">
        First deployments
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Kubeflow
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Kubeflow
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dashboard-access" class="md-nav__link">
    Dashboard access
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#challenges" class="md-nav__link">
    Challenges
  </a>
  
    <nav class="md-nav" aria-label="Challenges">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jupyterhub" class="md-nav__link">
    JupyterHub
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubeflow-pipelines" class="md-nav__link">
    Kubeflow Pipelines
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#katib-and-tensorboard" class="md-nav__link">
    Katib and Tensorboard
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../vanilla/" class="md-nav__link">
        Vanilla Kubernetes
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dashboard-access" class="md-nav__link">
    Dashboard access
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#challenges" class="md-nav__link">
    Challenges
  </a>
  
    <nav class="md-nav" aria-label="Challenges">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jupyterhub" class="md-nav__link">
    JupyterHub
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubeflow-pipelines" class="md-nav__link">
    Kubeflow Pipelines
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#katib-and-tensorboard" class="md-nav__link">
    Katib and Tensorboard
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="kubeflow">Kubeflow</h1>
<p>Per the <a href="https://www.kubeflow.org/docs/">Kubeflow documentation</a>,</p>
<blockquote>
<p>The Kubeflow project is dedicated to making deployments of machine learning
(ML) workflows on Kubernetes simple, portable and scalable. Our goal is not
to recreate other services, but to provide a straightforward way to deploy
best-of-breed open-source systems for ML to diverse infrastructures. Anywhere
you are running Kubernetes, you should be able to run Kubeflow.</p>
</blockquote>
<h2 id="installation">Installation</h2>
<blockquote>
<p>NOTE: As of this writing, the installation guidance only works for a
single-node MicroK8s cluster. Do not add the Pi nodes as workers. The
first apparent issue: the <code>hostpath-storage</code> addon creates a PersistentVolume
on the master node (<code>zephyrus</code>) but the PersistentVolumeClaim (PVC) created
by Juju as part of installing Kubeflow maps to a Pi node, meaning the
PVC will pend indefinitely.</p>
<p>It is also possible that the RAM requirements of Kubeflow would exceed
those available on the Pi nodes.</p>
</blockquote>
<p>As discussed in <a href="../k8s_management/#juju">Managing a K8s cluster</a>, we will
install
<a href="https://charmed-kubeflow.io/docs/quickstart">Charmed Kubeflow using <code>juju</code></a>.
With <code>microk8s</code> and <code>juju</code> already installed, the steps are:</p>
<ol>
<li>Bootstrap Juju to MicroK8s, deploying a controller to MicroK8s' Kubernetes:</li>
</ol>
<div class="highlight"><pre><span></span><code>juju<span class="w"> </span>bootstrap<span class="w"> </span>microk8s
</code></pre></div>
<p>The contoller is Juju's agent, running on Kubernetes, which can be used to
   deploy and control the components of Kubeflow. The controller works with
   <code>models</code>, which map to namespaces in Kubernetes.</p>
<ol>
<li>Add a model! For Kubeflow, the model <strong>must</strong> be named <code>kubeflow</code>:</li>
</ol>
<div class="highlight"><pre><span></span><code>juju<span class="w"> </span>add-model<span class="w"> </span>kubeflow
</code></pre></div>
<ol>
<li>Deploy a Kubeflow bundle. We will deploy a lighter option, <code>kubeflow-lite</code>:</li>
</ol>
<div class="highlight"><pre><span></span><code>juju<span class="w"> </span>deploy<span class="w"> </span>kubeflow-lite<span class="w"> </span>--trust
</code></pre></div>
<ol>
<li>Wait for and monitor the deployment process. It can take tens of minutes:</li>
</ol>
<div class="highlight"><pre><span></span><code>watch<span class="w"> </span>-c<span class="w"> </span>juju<span class="w"> </span>status<span class="w"> </span>--color
</code></pre></div>
<h2 id="dashboard-access">Dashboard access</h2>
<p>With Kubeflow deployed, the next step is dashboard access. The dashboard
is accessed through a central <code>istio-ingressgateway</code>. We first need to
find the external IP assigned to its LoadBalancer. To do that, run the
following:</p>
<div class="highlight"><pre><span></span><code>k<span class="w"> </span>-n<span class="w"> </span>kubeflow<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>istio-ingressgateway-workload<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.status.loadBalancer.ingress[0].ip}&#39;</span>
</code></pre></div>
<blockquote>
<p>NOTE: Here, <code>k</code> is an alias for <code>microk8s kubectl</code>.</p>
</blockquote>
<p>For this documentation, we will presume the IP is <code>192.168.1.193</code>.
Next, set up <a href="https://dexidp.io/">Dex</a> authentication credentials:</p>
<div class="highlight"><pre><span></span><code>juju<span class="w"> </span>config<span class="w"> </span>dex-auth<span class="w"> </span>static-username<span class="o">=</span>admin
juju<span class="w"> </span>config<span class="w"> </span>dex-auth<span class="w"> </span>static-password<span class="o">=</span>password
</code></pre></div>
<blockquote>
<p>NOTE: These are trivial credentials, feel free to choose a more secure
password.</p>
</blockquote>
<p>Finally, access the dashboard with the IP captured above via browser, and
log in using your chosen credentials.</p>
<blockquote>
<p>NOTE: As of this writing, only <em>insecure</em> HTTP access is working. Secure
HTTP access is being refused. Documentation will be updated when this is
resolved.</p>
</blockquote>
<h2 id="challenges">Challenges</h2>
<h3 id="jupyterhub">JupyterHub</h3>
<p>With JupyterHub, there were a couple problems:</p>
<ol>
<li><strong>Version assumptions in the Dashboard.</strong> The Kubeflow Dashboard <em>Notebooks</em>
   links make assumptions about the API endpoints of the running JupyterLab
   servers. Trying to run the latest Jupyter images (e.g.,
   <code>tensorflow/tensorflow:latest-jupyter</code>) causes errors when trying to
   connect to the running notebook.</li>
<li><strong>Inability to save notebooks.</strong> The notebooks ran fine when selecting
   older images (such as those suggested in the images dropdown) but were
   not saveable. JupyterLab would regularly display an error modal window
   indicating that autosave could not be completed because the targeted
   location on disk was read-only.</li>
</ol>
<h3 id="kubeflow-pipelines">Kubeflow Pipelines</h3>
<p>Kubeflow Pipelines worked fine when using the Kubeflow Pipelines compiler,
as demonstrated in the
<a href="https://charmed-kubeflow.io/docs/get-started-with-charmed-kubeflow#heading--kubeflow-pipeline">Charmed Kubeflow example</a>.
However, attempts to use the
<a href="https://kubeflow-pipelines.readthedocs.io/en/latest/source/kfp.client.html"><code>kfp.Client</code> class</a>,
ultimately met with SSL errors attempting to interact with the <code>ml-pipeline</code>
service, raising errors like the following:</p>
<div class="highlight"><pre><span></span><code>ssl.SSLError:<span class="w"> </span><span class="o">[</span>SSL:<span class="w"> </span>WRONG_VERSION_NUMBER<span class="o">]</span><span class="w"> </span>wrong<span class="w"> </span>version<span class="w"> </span>number<span class="w"> </span><span class="o">(</span>_ssl.c:1131<span class="o">)</span>
</code></pre></div>
<h3 id="katib-and-tensorboard">Katib and Tensorboard</h3>
<p>The hyperparameter tuning and experiment visualization tools were out of
scope of this exploration. Despite being visible on the Kubeflow Dashboard,
the <code>kubeflow-lite</code> bundle does not include Katib or Tensorboard controllers.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.a51614de.min.js"></script>
      
    
  </body>
</html>